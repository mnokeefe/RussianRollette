function updateProgress(t){progressCount+=t||1,progressCount>=progressTotalCount?($("#progress").css("width","100%"),$("#loading").slideUp(600)):$("#progress").css("width",parseInt(100*progressCount/progressTotalCount)+"%")}function preloader(t,e,s){function i(t,e){updateProgress(1),t&&alert("Failed to load "+e+": "+t),o++,a==o&&s()}var a=t.length,o=0;progressTotalCount+=t.length,t.forEach(function(t){e(t,i)})}function preloadImages(t,e){function s(t,e){t.img=new Image,t.img.src="assets/img/"+t.id+".png",t.img.addEventListener("load",function(){e()},!1),t.img.addEventListener("error",function(s){e(s,t.id)},!1)}preloader(t,s,e)}function _initWebAudio(t,e,s,i){function a(t,s){var i=new XMLHttpRequest;i.open("GET","assets/audio/"+t.id+"."+e,!0),i.responseType="arraybuffer",i.onload=function(){o.decodeAudioData(i.response,function(e){t.play=function(){var t=o.createBufferSource();t.buffer=e,t.connect(o.destination),t.noteOn(0)},t.gainNode=o.createGainNode(),t.gainNode.connect(o.destination),t.gainNode.gain.value=.5,s()},function(e){t.play=function(){},s(e,t.id)})},i.onerror=function(e){console.log(e),t.play=function(){},s(e,t.id)},i.send()}var o=new t;preloader(s,a,i)}function _initHTML5Audio(t,e,s){function i(e,s){e.audio=new Audio("assets/audio/"+e.id+"."+t),e.audio.preload="auto",e.audio.addEventListener("loadeddata",function(){e.play=function(){e.audio.play()},e.audio.volume=.6,s()},!1),e.audio.addEventListener("error",function(t){e.play=function(){},s(t,e.id)},!1)}preloader(e,i,s)}function initAudio(t,e){var s="mp3",i=document.createElement("audio");i&&!i.canPlayType("audio/mpeg;")&&i.canPlayType("audio/ogg;")&&(s="ogg");var a=window.webkitAudioContext||window.mozAudioContext||window.MSAudioContext||window.AudioContext;return a?($("#audio_debug").text("WebAudio Supported"),_initWebAudio(a,s,t,e)):i?($("#audio_debug").text("HTML5 Audio Supported"),_initHTML5Audio(s,t,e)):($("#audio_debug").text("Audio NOT Supported"),t.forEach(function(t){t.play=function(){}}),e(),void 0)}function copyArray(t){for(var e=[],s=0;s<t.length;s++)e.push(t[s]);return e}function shuffleArray(t){var e;for(e=t.length-1;e>0;e--){var s=parseInt(Math.random()*e),i=t[e];t[e]=t[s],t[s]=i}}function SlotGame(){function t(){function t(t,e){var s=t.getContext("2d");s.fillStyle="#ddd";for(var i=0;ITEM_COUNT>i;i++){var a=e[i];s.save(),s.shadowColor="rgba(0,0,0,0.5)",s.shadowOffsetX=5,s.shadowOffsetY=5,s.shadowBlur=5,s.drawImage(a.img,3,i*SLOT_HEIGHT+IMAGE_TOP_MARGIN),s.drawImage(a.img,3,(i+ITEM_COUNT)*SLOT_HEIGHT+IMAGE_TOP_MARGIN),s.restore(),s.fillRect(0,i*SLOT_HEIGHT,70,SLOT_SEPARATOR_HEIGHT),s.fillRect(0,(i+ITEM_COUNT)*SLOT_HEIGHT,70,SLOT_SEPARATOR_HEIGHT)}}o&&a&&(e.items1=copyArray(s),shuffleArray(e.items1),t(e.c1[0],e.items1),e.items2=copyArray(s),shuffleArray(e.items2),t(e.c2[0],e.items2),e.items3=copyArray(s),shuffleArray(e.items3),t(e.c3[0],e.items3),e.resetOffset=(ITEM_COUNT+3)*SLOT_HEIGHT,e.loop(),$("#play").click(function(){$("h1").text("Firing!"),$("#play").hide(),e.audios[0].play(),e.restart()}))}var e=new Game,s=[{id:"bacon-64",title:"bacon"},{id:"blackpudding-64",title:"black pudding"},{id:"cheese-64",title:"cheese"},{id:"egg-64",title:"egg"},{id:"mushroom-64",title:"mushroom"},{id:"onion-64",title:"onion"},{id:"sausage-64",title:"sausage"},{id:"veggie-64",title:"veggie sausage"}],i=[{id:"roll"},{id:"slot"},{id:"win"}];$("canvas").attr("height",2*IMAGE_HEIGHT*ITEM_COUNT),$("canvas").css("height",2*IMAGE_HEIGHT*ITEM_COUNT),e.items=s,e.audios=i;var a=!1,o=!1;initAudio(i,function(){o=!0,t()}),preloadImages(s,function(){a=!0,t()});var n=1;$("#debug").click(function(){n=1-n,n?$("#reels").css("overflow","hidden"):$("#reels").css("overflow","visible")})}function Game(){this.c1=$("#canvas1"),this.c2=$("#canvas2"),this.c3=$("#canvas3"),this.offset1=-parseInt(Math.random()*ITEM_COUNT)*SLOT_HEIGHT,this.offset2=-parseInt(Math.random()*ITEM_COUNT)*SLOT_HEIGHT,this.offset3=-parseInt(Math.random()*ITEM_COUNT)*SLOT_HEIGHT,this.speed1=this.speed2=this.speed3=0,this.lastUpdate=new Date,this.vendor=/webkit/i.test(navigator.appVersion)?"-webkit":/firefox/i.test(navigator.userAgent)?"-moz":/msie/i.test(navigator.userAgent)?"ms":"opera"in window?"-o":"",this.cssTransform=this.vendor+"-transform",this.has3d="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,this.trnOpen="translate"+(this.has3d?"3d(":"("),this.trnClose=this.has3d?",0)":")",this.scaleOpen="scale"+(this.has3d?"3d(":"("),this.scaleClose=this.has3d?",0)":")",this.draw(!0)}var progressCount=0,progressTotalCount=0,IMAGE_HEIGHT=64,IMAGE_TOP_MARGIN=5,IMAGE_BOTTOM_MARGIN=5,SLOT_SEPARATOR_HEIGHT=2,SLOT_HEIGHT=IMAGE_HEIGHT+IMAGE_TOP_MARGIN+IMAGE_BOTTOM_MARGIN+SLOT_SEPARATOR_HEIGHT,RUNTIME=2e3,SPINTIME=1e3,ITEM_COUNT=8,SLOT_SPEED=15,DRAW_OFFSET=45;Game.prototype.restart=function(){this.lastUpdate=new Date,this.speed1=this.speed2=this.speed3=SLOT_SPEED,this.result1=parseInt(Math.random()*this.items1.length),this.result2=parseInt(Math.random()*this.items2.length),this.result3=parseInt(Math.random()*this.items3.length),this.stopped1=!1,this.stopped2=!1,this.stopped3=!1,this.offset1=-parseInt(Math.random(ITEM_COUNT))*SLOT_HEIGHT,this.offset2=-parseInt(Math.random(ITEM_COUNT))*SLOT_HEIGHT,this.offset3=-parseInt(Math.random(ITEM_COUNT))*SLOT_HEIGHT,$("#results").hide(),$("#order-button").remove(),this.state=1},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Game.prototype.loop=function(){var t=this;t.running=!0,function e(){t.update(),t.draw(),t.running&&requestAnimFrame(e)}()},Game.prototype.update=function(){function t(t,i){if(e-s.lastUpdate>SPINTIME){var a=parseInt(Math.abs(t/SLOT_HEIGHT))%ITEM_COUNT;if(a==i)if(0==i){if(Math.abs(t+ITEM_COUNT*SLOT_HEIGHT)<1.5*SLOT_SPEED)return!0}else if(Math.abs(t+i*SLOT_HEIGHT)<1.5*SLOT_SPEED)return!0}return!1}var e=new Date,s=this;switch(this.state){case 1:e-this.lastUpdate>RUNTIME&&(this.state=2,this.lastUpdate=e);break;case 2:this.stopped1=t(this.offset1,this.result1),this.stopped1&&(this.speed1=0,this.state++,this.lastUpdate=e,this.audios[1].play());break;case 3:this.stopped2=t(this.offset2,this.result2),this.stopped2&&(this.speed2=0,this.state++,this.lastUpdate=e,this.audios[1].play());break;case 4:this.stopped3=t(this.offset3,this.result3),this.stopped3&&(this.speed3=0,this.state++,this.audios[1].play());break;case 5:e-this.lastUpdate>1e3&&(this.state=6);break;case 6:var i=s.items1[s.result1].title+", "+s.items2[s.result2].title+" and "+s.items3[s.result3].title,a="kaleigh.simms@sequence.co.uk",o="Roll%20Order",n="Hi Kaleigh, I'd like a "+i+" roll please.";$('<a href="mailto:'+a+"?&subject="+o+"&body="+n+'" class="button button--main" id="order-button">Order it</a>').prependTo("#buttons"),$("#results").show(),$("h1").text("Enjoy your "+i+" roll!"),$("#play").text("FIRE AGAIN! (wuss)").removeClass("button--main").addClass("button--secondary").show(),this.audios[2].play(),this.state=7;break;case 7:}this.lastupdate=e},Game.prototype.draw=function(t){if(!(this.state>=6))for(var e=1;3>=e;e++){var s="result"+e,i="stopped"+e,a="speed"+e,o="offset"+e,n="c"+e;if(this[i]||this[a]||t){if(this[i]){this[a]=0;var r=this[s];this[o]=-(r*SLOT_HEIGHT),this[o]+DRAW_OFFSET>0&&(this[o]=-this.resetOffset+3*SLOT_HEIGHT)}else this[o]+=this[a],this[o]+DRAW_OFFSET>0&&(this[o]=-this.resetOffset+3*SLOT_HEIGHT-DRAW_OFFSET);this[n].css(this.cssTransform,this.trnOpen+"0px, "+(this[o]+DRAW_OFFSET)+"px"+this.trnClose)}}};